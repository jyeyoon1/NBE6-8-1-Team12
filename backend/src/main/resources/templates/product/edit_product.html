<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>상품 수정</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
          background: #ddd;
        }

        .card {
          margin: auto;
          max-width: 700px;
          width: 90%;
          box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 0.19);
          border-radius: 1rem;
          border: transparent;
          padding: 2rem;
          background-color: white;
        }

        h1 {
          text-align: center;
          margin-top: 2rem;
          margin-bottom: 2rem;
        }
    </style>
</head>
<body>
<h1>상품 수정 페이지</h1>

<div class="card">

    <!-- 이미지 미리보기 -->
    <img th:if="${product.image_url}" th:src="${product.image_url}" alt="상품 이미지" class="product-img" id="preview"/>

    <!-- 수정 폼 -->
    <form id="editForm">
        <div class="mb-3">
            <label for="productName" class="form-label">상품명</label>
            <input type="text" class="form-control" id="productName" th:value="${product.productName}" placeholder="예: Columbia Nariñó">
        </div>

        <div class="mb-3">
            <label for="description" class="form-label">설명</label>
            <input type="text" class="form-control" id="description" th:value="${product.description}" placeholder="예: 커피콩">
        </div>

        <div class="mb-3">
            <label for="price" class="form-label">가격 (원)</label>
            <input type="number" class="form-control" id="price" th:value="${product.price}" placeholder="예: 5000">
        </div>

        <div class="mb-3">
            <label for="image_url" class="form-label">이미지 URL</label>
            <input type="url" class="form-control" id="image_url" th:value="${product.image_url}" placeholder="예: https://i.imgur.com/HKOFQYa.jpeg" oninput="document.getElementById('preview').src = this.value">
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-primary w-100">수정 완료</button>
        </div>
    </form>
</div>

<script th:inline="javascript">
    const productId = [[${product.id}]];

    document.getElementById('editForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const data = {
            productName: document.getElementById('productName').value,
            description: document.getElementById('description').value,
            price: parseFloat(document.getElementById('price').value),
            image_url: document.getElementById('image_url').value
        };

        fetch(`/api/products/${productId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(res => {
            if (res.ok) {
                alert('상품이 정상적으로 수정되었습니다.');
                window.location.href = `/api/products/${productId}`;
            } else {
                alert('상품 수정에 실패하였습니다. 다시 시도해주세요.');
            }
        });
    });
</script>

</body>
</html>